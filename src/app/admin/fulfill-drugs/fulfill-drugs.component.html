<nav class="breadcrumb">
  <!-- <a class="breadcrumb-item" href="javascript://" routerLink="/admin/requisition-min-max">ตั้งค่า MIN-MAX</a> -->
  <span>เติมยา</span>
</nav>

<clr-tabs>
  <clr-tab>
    <button clrTabLink id="link1" (click)="getProducts()">เติมยา</button>
    <clr-tab-content id="content1" *clrIfActive>

      <button class="btn btn-success btn-sm" (click)="onClickFulFill()">เติมยา {{selected.length+' รายการ'}}</button>
      <table class="table" style="width:100%">
        <tr>
          <td>Hydroxychloroquine 200 mg.<br>0 Tab</td>
          <td>Chloroquine 250 mg.<br>0 Tab</td>
          <td>Darunavir 600mg<br>0 Tab</td>
          <td>Lopinavir 200 mg/Ritonavir 50 mg.<br>0 Tab</td>
          <td>Azithromycin 250 mg.<br>0 Tab</td>
        </tr>
      </table>
      <div style="overflow-x: scroll;width: 100%;">
        <table class="table table-compact" style="width:max-content;max-width: max-content;border-collapse: collapse;">
          <thead>
            <tr>
              <th class="td-border" rowspan="2">เขต</th>
              <th class="td-border" rowspan="2">จังหวัด</th>
              <th class="td-border" colspan="4">CQ</th>
              <th class="td-border" colspan="4">HCQ</th>
              <th class="td-border" colspan="4">DRV</th>
              <th class="td-border" colspan="4">RTV</th>
              <th class="td-border" colspan="4">LPV/r</th>
              <th class="td-border" colspan="4">Azithromycin</th>
            </tr>
            <tr>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
              <th class="td-border">รับเข้า</th>
              <th class="td-border">ใช้ไป</th>
              <th class="td-border">คงเหลือ</th>
              <th class="td-border">เติมยา</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let i of products">
              <td class="td-border">{{i.zone_code}}</td>
              <td class="td-border text-left">{{i.hospital_name}}</td>
              <td class="td-border text-left">{{i.hydroxy_chloroquine_total_qty}}</td>
              <td class="td-border text-left"></td>
              <td class="td-border text-left">{{i.hydroxy_chloroquine_qty}}</td>
              <td class="td-border text-left"><input type="text" class="clr-input" style="width: 50px;"
                  [value]="i.hydroxy_chloroquine_recomment_qty"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
              <td class="td-border"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <clr-datagrid [clrDgLoading]="loading" [style.height.px]="800" [(clrDgSelected)]="selected">
        <clr-dg-column>โรงพยาบาล</clr-dg-column>
        <clr-dg-column>ชื่อยา</clr-dg-column>
        <clr-dg-column>คงคลัง</clr-dg-column>
        <clr-dg-column>min/max</clr-dg-column>
        <clr-dg-column>safety stock</clr-dg-column>
        <clr-dg-column>ยอดแนะนำ</clr-dg-column>
        <clr-dg-column>ยอดเติม</clr-dg-column>

        <clr-dg-row *clrDgItems="let i of products" [clrDgItem]="i">
          <clr-dg-cell>{{i.hospital_name}}</clr-dg-cell>
          <clr-dg-cell>{{i.generic_name}}</clr-dg-cell>
          <clr-dg-cell>{{i.qty}} {{i.reserve_qty? '(+'+i.reserve_qty+')' : ''}}</clr-dg-cell>
          <clr-dg-cell>{{i.min}}/{{i.max}}</clr-dg-cell>
          <clr-dg-cell>{{i.safety_stock}}</clr-dg-cell>
          <clr-dg-cell>{{i.recommend_fill_qty}}</clr-dg-cell>
          <clr-dg-cell>
            <input type="text" appNumberOnly name="{{i.fill_qty}}" [(ngModel)]="i.fill_qty">
          </clr-dg-cell>
        </clr-dg-row>
        <!-- <clr-dg-footer>
            <clr-dg-pagination #pagination [clrDgTotalItems]="total" [clrDgPageSize]="limit">
              <clr-dg-page-size [clrPageSizeOptions]="[10,20,50,100]">จำนวนรายการต่อหน้า</clr-dg-page-size>
              {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} จาก {{pagination.totalItems}} รายการ
            </clr-dg-pagination>
          </clr-dg-footer> -->
      </clr-datagrid>
    </clr-tab-content>
  </clr-tab>
  <clr-tab>
    <button clrTabLink id="link1" (click)="getProducts()">เติมยา(รายรพ.)</button>
    <clr-tab-content id="content1" *clrIfActive>
      <div class="clr-row">
        <div class="clr-col-3">
          <clr-datagrid [clrDgLoading]="loading" [style.height.px]="800">
            <clr-dg-column>โรงพยาบาล</clr-dg-column>
            <clr-dg-row *clrDgItems="let i of nodes" [clrDgItem]="i" [ngClass]="{isSuccess: hospitalId==i.hospital_id}"
              (click)="getBalanceDrugs(i.hospital_id);hospitalId=i.hospital_id">
              <clr-dg-cell>{{i.hospname}}</clr-dg-cell>
            </clr-dg-row>
          </clr-datagrid>
        </div>
        <div class="clr-col-9">
          <clr-datagrid [clrDgLoading]="loading" [style.height.px]="800">
            <clr-dg-column>ชื่อยา</clr-dg-column>
            <clr-dg-column>คงคลัง</clr-dg-column>
            <clr-dg-column>min/max</clr-dg-column>
            <clr-dg-column>safety stock</clr-dg-column>
            <clr-dg-column>ยอดแนะนำ</clr-dg-column>
            <clr-dg-column>ยอดเติม</clr-dg-column>
            <clr-dg-row *clrDgItems="let i of generics" [clrDgItem]="i">
              <clr-dg-cell>{{i.generic_name}}</clr-dg-cell>
              <clr-dg-cell>{{i.qty}} {{i.reserve_qty? '(+'+i.reserve_qty+')' : ''}}</clr-dg-cell>
              <clr-dg-cell>{{i.min}}/{{i.max}}</clr-dg-cell>
              <clr-dg-cell>{{i.safety_stock}}</clr-dg-cell>
              <clr-dg-cell>{{i.recommend_fill_qty}}</clr-dg-cell>
              <clr-dg-cell>
                <input type="text" appNumberOnly name="{{i.fill_qty}}" [(ngModel)]="i.fill_qty">
              </clr-dg-cell>
            </clr-dg-row>
          </clr-datagrid>
        </div>
      </div>
    </clr-tab-content>
  </clr-tab>
  <clr-tab>
    <button clrTabLink>รายการเติมยา</button>
    <clr-tab-content *clrIfActive>
      <button class="btn btn-primary btn-sm" (click)="onClickExport()">Export {{countExport+' รายการ'}}</button>
      <button class="btn btn-success btn-sm" (click)="onClickApprove()">อนุมัติ {{countApprove+' รายการ'}}</button>
      <clr-datagrid [clrDgLoading]="loading" [style.height.px]="800" [(clrDgSelected)]="selectedFulfills"
        (clrDgSelectedChange)="selectionChanged($event)">
        <clr-dg-column>ใบเติม</clr-dg-column>
        <clr-dg-column>วันที่เติม</clr-dg-column>
        <clr-dg-column>ผู้เติม</clr-dg-column>
        <clr-dg-column>สถานะ</clr-dg-column>
        <!-- <clr-dg-column></clr-dg-column> -->

        <clr-dg-row *clrDgItems="let i of fulfills" [clrDgItem]="i" [ngClass]="{isProblem: i.is_approved == 'Y'}">
          <clr-dg-cell>{{i.code}}</clr-dg-cell>
          <clr-dg-cell>{{i.created_date | dateTh:'D MMM YYYY'}}</clr-dg-cell>
          <clr-dg-cell>{{i.fname}} {{i.lname}}</clr-dg-cell>
          <clr-dg-cell>{{i.is_approved == 'Y' ? 'อนุมัติแล้ว':'รออนุมัติ'}}</clr-dg-cell>
          <app-fulfill-drug-details [id]="i.id" *clrIfExpanded ngProjectAs="clr-dg-row-detail">
          </app-fulfill-drug-details>
          <!-- <clr-dg-cell>
            <input type="text" appNumberOnly name="{{i.fill_qty}}" [(ngModel)]="i.fill_qty">
          </clr-dg-cell> -->
        </clr-dg-row>
        <!-- <clr-dg-footer>
            <clr-dg-pagination #pagination [clrDgTotalItems]="total" [clrDgPageSize]="limit">
              <clr-dg-page-size [clrPageSizeOptions]="[10,20,50,100]">จำนวนรายการต่อหน้า</clr-dg-page-size>
              {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} จาก {{pagination.totalItems}} รายการ
            </clr-dg-pagination>
          </clr-dg-footer> -->
      </clr-datagrid>
    </clr-tab-content>
  </clr-tab>
</clr-tabs>

<app-loadding #modalLoading></app-loadding>
